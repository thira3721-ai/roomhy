<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roomhy - Booking Requests</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="../website/js/area-manager-profile.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* --- Sidebar Styling --- */
        .sidebar { background-color: #111827; color: #9ca3af; }
        .sidebar-link {
            display: flex; align-items: center; padding: 0.75rem 1.5rem; 
            color: #9ca3af; font-weight: 500; font-size: 0.9rem;
            transition: all 0.2s; border-left: 3px solid transparent; cursor: pointer;
        }
        .sidebar-link:hover { background-color: #1f2937; color: #f3f4f6; }
        .sidebar-link.active { background-color: #1f2937; color: #ffffff; border-left-color: #a855f7; }

        /* Submenu Styling */
        .submenu { background-color: #0f172a; overflow: hidden; transition: max-height 0.3s ease-in-out; max-height: 0; }
        .submenu.open { max-height: 500px; }
        .submenu a { padding-left: 3.5rem; font-size: 0.85rem; }

        .tab-btn { padding: 12px 20px; font-weight: 600; border-bottom: 3px solid transparent; cursor: pointer; transition: all 0.2s; }
        .tab-btn.active { color: #7c3aed; border-bottom-color: #7c3aed; }
        .tab-btn:not(.active) { color: #9ca3af; }

        .request-card { border-left: 4px solid #3b82f6; background: white; padding: 16px; border-radius: 8px; margin-bottom: 16px; }
        .bid-card { border-left: 4px solid #10b981; background: white; padding: 16px; border-radius: 8px; margin-bottom: 16px; }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }

        .badge { display: inline-block; padding: 6px 12px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
        .badge-pending { background: #fef3c7; color: #b45309; }
        .badge-confirmed { background: #dcfce7; color: #15803d; }
        .badge-paid { background: #dbeafe; color: #1e40af; }
    </style>
</head>
<body class="text-slate-800">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar (Area Manager - Full) -->
        <aside class="sidebar w-72 flex-shrink-0 hidden md:flex flex-col z-20 overflow-y-auto custom-scrollbar">
            <div class="h-16 flex items-center px-6 border-b border-gray-800 sticky top-0 bg-[#111827] z-10">
                 <div class="flex items-center gap-3">
                     <div class="bg-purple-600 p-1.5 rounded-lg"><i data-lucide="map" class="w-5 h-5 text-white"></i></div>
                     <div><h1 class="text-xl font-bold text-white">RoomHy</h1><span class="text-[10px] text-gray-500">AREA ADMIN</span></div>
                 </div>
            </div>
            
            <nav class="flex-1 py-6 space-y-1">
                <div class="px-6 pb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Overview</div>
                <a href="areaadmin.html" class="sidebar-link"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i> Dashboard</a>

                <div class="mt-6 px-6 pb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Management</div>
                <a href="areaproperty.html" class="sidebar-link"><i data-lucide="home" class="w-5 h-5 mr-3"></i> Properties</a>
                <a href="visit.html" class="sidebar-link"><i data-lucide="clipboard-list" class="w-5 h-5 mr-3"></i> Visit Reports</a>
                <a href="areatenant.html" class="sidebar-link"><i data-lucide="users" class="w-5 h-5 mr-3"></i> Tenants</a>
                <a href="areaowner.html" class="sidebar-link"><i data-lucide="briefcase" class="w-5 h-5 mr-3"></i> Owners</a>
                <a href="booking_request.html" class="sidebar-link active"><i data-lucide="calendar-check" class="w-5 h-5 mr-3"></i> Booking Requests</a>

                <div class="mt-6 px-6 pb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Operations</div>
                <a href="areapayment.html" class="sidebar-link"><i data-lucide="wallet" class="w-5 h-5 mr-3"></i> Payments</a>
                <a href="complaint.html" class="sidebar-link"><i data-lucide="alert-circle" class="w-5 h-5 mr-3"></i> Complaints & Maint.</a>
                <a href="areakyc.html" class="sidebar-link"><i data-lucide="file-check" class="w-5 h-5 mr-3"></i> KYC Verification</a>
                 <a href="areaenq.html" class="sidebar-link"><i data-lucide="help-circle" class="w-5 h-5 mr-3"></i> Enquiries</a>

                <div class="mt-6 px-6 pb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Communication</div>
                <a href="areachat.html" class="sidebar-link"><i data-lucide="message-square" class="w-5 h-5 mr-3"></i> Chat</a>

                <div class="mt-6 px-6 pb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">System</div>
                 <a href="arealoc.html" class="sidebar-link"><i data-lucide="map-pin" class="w-5 h-5 mr-3"></i> RoomHy Location</a>
                 <a href="areareport.html" class="sidebar-link"><i data-lucide="bar-chart-2" class="w-5 h-5 mr-3"></i> Reports</a>
                 <a href="profile.html" class="sidebar-link"><i data-lucide="user" class="w-5 h-5 mr-3"></i> Profile</a>
                 <a href="setting.html" class="sidebar-link"><i data-lucide="settings" class="w-5 h-5 mr-3"></i> Settings</a>
            </nav>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden bg-[#f3f4f6]">
            <header class="bg-white h-16 flex items-center justify-between px-6 shadow-sm z-10">
                <div class="flex items-center">
                    <button id="mobile-menu-open" class="md:hidden mr-4 text-slate-500"><i data-lucide="menu" class="w-6 h-6"></i></button>
                    <div class="flex items-center">
                        <span class="text-slate-500 font-medium text-sm">Area:</span>
                        <span class="ml-2 px-3 py-1 rounded-full bg-purple-100 text-purple-700 text-xs font-bold" id="userAreaBadge">Loading...</span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="relative group">
                        <button class="flex items-center gap-3 hover:bg-gray-50 p-1.5 rounded-full transition-colors">
                            <img src="https://i.pravatar.cc/150?u=areaadmin" alt="Admin" class="w-8 h-8 rounded-full border border-slate-200">
                            <div class="text-left hidden sm:block">
                                <p class="text-xs font-semibold text-gray-700" id="headerName">Manager</p>
                                <p class="text-[10px] text-gray-500" id="headerRole">Area Manager</p>
                            </div>
                            <i data-lucide="chevron-down" class="w-3 h-3 text-gray-400 hidden sm:block"></i>
                        </button>
                    </div>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto p-8">
                <!-- Page Header -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
                        <i data-lucide="calendar-check" class="w-8 h-8 text-purple-600"></i>
                        Booking Requests & Bids
                    </h1>
                    <p class="text-gray-600 mt-2">Manage booking requests and bids from tenants in your area</p>
                </div>

                <!-- Search & Filter Bar -->
                <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <input type="text" id="searchInput" placeholder="Search by property, user, or ID..." 
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-purple-500">
                        </div>
                        <div>
                            <select id="statusFilter" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-purple-500">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                                <option value="visited">Visited</option>
                            </select>
                        </div>
                        <div>
                            <button onclick="loadBookingRequests()" class="w-full bg-purple-600 text-white rounded-lg px-4 py-2 hover:bg-purple-700 font-medium">
                                Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Booking Requests Table -->
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead class="bg-gray-50 border-b border-gray-200 sticky top-0">
                                <tr class="text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">
                                    <th class="px-4 py-3 whitespace-nowrap">Property ID</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Property Name</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Area</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Type</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Rent</th>
                                    <th class="px-4 py-3 whitespace-nowrap">User ID</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Name</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Phone</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Email</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Manager ID</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Request Type</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Bid Amount</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Message</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Status</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Visit Type</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Visit Date</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Visit Slot</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Visit Status</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Created</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Updated</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookingTableBody" class="divide-y divide-gray-200">
                                <tr class="text-center py-8 text-gray-500">
                                    <td colspan="21" class="py-8">
                                        <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                                        <p>No booking requests found</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>



    <script>
        // Get area from local storage or session
        const userArea = localStorage.getItem('userArea') || sessionStorage.getItem('userArea') || 'All Areas';
        document.getElementById('userAreaBadge').textContent = userArea;

        let allBookingRequests = [];
        let filteredRequests = [];

        // Load booking requests from API
        async function loadBookingRequests() {
            try {
                // Get area manager ID from session/localStorage
                const user = JSON.parse(localStorage.getItem('user') || sessionStorage.getItem('user') || '{}');
                const areaManagerId = user.area_manager_id || localStorage.getItem('area_manager_id') || 'AM001';

                const apiUrl = window.location.hostname === 'localhost' 
                    ? 'http://localhost:5000' 
                    : window.location.origin;

                // Fetch from API with area_manager_id filter
                const response = await fetch(
                    `${apiUrl}/api/booking/requests?area_manager_id=${areaManagerId}`,
                    {
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' }
                    }
                );

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                allBookingRequests = data.data || data.bookings || [];
                
                // If API call failed or returned empty, fall back to localStorage
                if (allBookingRequests.length === 0) {
                    console.log('No bookings from API, trying localStorage...');
                    const bookingRequests = JSON.parse(localStorage.getItem('roomhy_booking_requests') || '[]');
                    const users = JSON.parse(localStorage.getItem('roomhy_kyc_verification') || '[]');
                    
                    const userMap = {};
                    users.forEach(user => {
                        userMap[user.id] = user;
                    });

                    allBookingRequests = bookingRequests.map(request => {
                        const user = userMap[request.user_id] || {};
                        return {
                            ...request,
                            name: user.firstName ? `${user.firstName} ${user.lastName || ''}` : 'N/A',
                            phone: user.phone || 'N/A',
                            email: user.email || 'N/A'
                        };
                    });
                }

                filteredRequests = [...allBookingRequests];
                renderBookingTable();
            } catch (error) {
                console.error('Error loading booking requests:', error);
                // Fall back to localStorage on error
                try {
                    const bookingRequests = JSON.parse(localStorage.getItem('roomhy_booking_requests') || '[]');
                    const users = JSON.parse(localStorage.getItem('roomhy_kyc_verification') || '[]');
                    
                    const userMap = {};
                    users.forEach(user => {
                        userMap[user.id] = user;
                    });

                    allBookingRequests = bookingRequests.map(request => {
                        const user = userMap[request.user_id] || {};
                        return {
                            ...request,
                            name: user.firstName ? `${user.firstName} ${user.lastName || ''}` : 'N/A',
                            phone: user.phone || 'N/A',
                            email: user.email || 'N/A'
                        };
                    });

                    filteredRequests = [...allBookingRequests];
                    renderBookingTable();
                } catch (fallbackError) {
                    console.error('Error loading from localStorage:', fallbackError);
                }
            }
        }

        // Render booking requests table
        function renderBookingTable() {
            const tableBody = document.getElementById('bookingTableBody');

            if (filteredRequests.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="21" class="py-8 text-center text-gray-500">
                            <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                            <p>No booking requests found</p>
                        </td>
                    </tr>
                `;
                lucide.createIcons();
                return;
            }

            tableBody.innerHTML = filteredRequests.map((req, index) => `
                <tr class="hover:bg-gray-50 text-sm border-b border-gray-200">
                    <td class="px-4 py-3 text-gray-900 font-medium whitespace-nowrap">${req.property_id || 'N/A'}</td>
                    <td class="px-4 py-3 text-gray-900 whitespace-nowrap">${req.property_name || 'N/A'}</td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap">${req.area || 'N/A'}</td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap">${req.property_type || 'N/A'}</td>
                    <td class="px-4 py-3 text-gray-900 font-semibold whitespace-nowrap">₹${req.rent_amount || 0}</td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap">${req.user_id || 'N/A'}</td>
                    <td class="px-4 py-3 text-gray-900 font-medium whitespace-nowrap">${req.name}</td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap">${req.phone}</td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap">${req.email}</td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap">${req.area_manager_id || 'N/A'}</td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap">${req.request_type || 'N/A'}</td>
                    <td class="px-4 py-3 text-gray-900 font-semibold whitespace-nowrap">₹${req.bid_amount || 0}</td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap max-w-xs truncate">${req.message || 'N/A'}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusBadgeClass(req.status)}">
                            ${(req.status || 'pending').charAt(0).toUpperCase() + (req.status || 'pending').slice(1)}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap">${req.visit_type || 'N/A'}</td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap">${req.visit_date ? new Date(req.visit_date).toLocaleDateString() : 'N/A'}</td>
                    <td class="px-4 py-3 text-gray-600 whitespace-nowrap">${req.visit_time_slot || 'N/A'}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold ${getVisitStatusBadgeClass(req.visit_status)}">
                            ${(req.visit_status || 'pending').charAt(0).toUpperCase() + (req.visit_status || 'pending').slice(1)}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-gray-500 whitespace-nowrap text-xs">${req.created_at ? new Date(req.created_at).toLocaleDateString() : 'N/A'}</td>
                    <td class="px-4 py-3 text-gray-500 whitespace-nowrap text-xs">${req.updated_at ? new Date(req.updated_at).toLocaleDateString() : 'N/A'}</td>
                    <td class="px-4 py-3 whitespace-nowrap flex gap-1">
                        <a href="https://wa.me/${req.phone?.replace(/\D/g, '')}" target="_blank" rel="noopener noreferrer" 
                            class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-green-100 text-green-600 hover:bg-green-200 transition" title="WhatsApp">
                            <i data-lucide="message-circle" class="w-4 h-4"></i>
                        </a>
                        <a href="areachat.html?user=${req.user_id}" 
                            class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 transition" title="Chat">
                            <i data-lucide="message-square" class="w-4 h-4"></i>
                        </a>
                        ${req.status === 'pending' ? `
                        <button onclick="approveBooking('${req._id || req.id}')" 
                            class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-green-100 text-green-600 hover:bg-green-200 transition" title="Approve">
                            <i data-lucide="check" class="w-4 h-4"></i>
                        </button>
                        <button onclick="rejectBooking('${req._id || req.id}')" 
                            class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition" title="Reject">
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                        ` : ''}
                        ${req.visit_status !== 'scheduled' && req.status !== 'rejected' ? `
                        <button onclick="scheduleVisitClick('${req._id || req.id}')" 
                            class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 transition" title="Schedule Visit">
                            <i data-lucide="calendar" class="w-4 h-4"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');

            lucide.createIcons();
        }

        // Get status badge CSS class
        function getStatusBadgeClass(status) {
            const statusMap = {
                'pending': 'bg-yellow-100 text-yellow-800',
                'approved': 'bg-green-100 text-green-800',
                'rejected': 'bg-red-100 text-red-800',
                'visited': 'bg-blue-100 text-blue-800'
            };
            return statusMap[status] || 'bg-gray-100 text-gray-800';
        }

        // Get visit status badge CSS class
        function getVisitStatusBadgeClass(status) {
            const statusMap = {
                'pending': 'bg-yellow-100 text-yellow-800',
                'scheduled': 'bg-blue-100 text-blue-800',
                'completed': 'bg-green-100 text-green-800',
                'cancelled': 'bg-red-100 text-red-800'
            };
            return statusMap[status] || 'bg-gray-100 text-gray-800';
        }

        // Search and filter functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            filteredRequests = allBookingRequests.filter(req => {
                const matchesSearch = !searchTerm || 
                    (req.property_name && req.property_name.toLowerCase().includes(searchTerm)) ||
                    (req.property_id && req.property_id.toLowerCase().includes(searchTerm)) ||
                    (req.user_id && req.user_id.toLowerCase().includes(searchTerm)) ||
                    (req.name && req.name.toLowerCase().includes(searchTerm)) ||
                    (req.email && req.email.toLowerCase().includes(searchTerm));

                const matchesStatus = !statusFilter || req.status === statusFilter;

                return matchesSearch && matchesStatus;
            });

            renderBookingTable();
        });

        // Status filter functionality
        document.getElementById('statusFilter').addEventListener('change', (e) => {
            const statusFilter = e.target.value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            filteredRequests = allBookingRequests.filter(req => {
                const matchesSearch = !searchTerm || 
                    (req.property_name && req.property_name.toLowerCase().includes(searchTerm)) ||
                    (req.property_id && req.property_id.toLowerCase().includes(searchTerm)) ||
                    (req.user_id && req.user_id.toLowerCase().includes(searchTerm)) ||
                    (req.name && req.name.toLowerCase().includes(searchTerm)) ||
                    (req.email && req.email.toLowerCase().includes(searchTerm));

                const matchesStatus = !statusFilter || req.status === statusFilter;

                return matchesSearch && matchesStatus;
            });

            renderBookingTable();
        });

        // Load data on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadBookingRequests();
            // Refresh data every 30 seconds
            setInterval(loadBookingRequests, 30000);
        });

        // ============ ACTION FUNCTIONS ============

        // Approve booking
        async function approveBooking(bookingId) {
            if (!confirm('Are you sure you want to approve this booking?')) return;

            try {
                const apiUrl = window.location.hostname === 'localhost' 
                    ? 'http://localhost:5000' 
                    : window.location.origin;

                const response = await fetch(`${apiUrl}/api/booking/requests/${bookingId}/approve`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });

                if (response.ok) {
                    alert('Booking approved successfully!');
                    loadBookingRequests();
                } else {
                    alert('Error approving booking');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error approving booking');
            }
        }

        // Reject booking
        async function rejectBooking(bookingId) {
            const reason = prompt('Enter reason for rejection:');
            if (!reason) return;

            try {
                const apiUrl = window.location.hostname === 'localhost' 
                    ? 'http://localhost:5000' 
                    : window.location.origin;

                const response = await fetch(`${apiUrl}/api/booking/requests/${bookingId}/reject`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ reason: reason })
                });

                if (response.ok) {
                    alert('Booking rejected');
                    loadBookingRequests();
                } else {
                    alert('Error rejecting booking');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error rejecting booking');
            }
        }

        // Schedule visit
        function scheduleVisitClick(bookingId) {
            const visitType = prompt('Enter visit type (physical/virtual):');
            if (!visitType) return;

            const visitDate = prompt('Enter visit date (YYYY-MM-DD):');
            if (!visitDate) return;

            const timeSlot = prompt('Enter time slot (e.g., 10:00-11:00):');
            if (!timeSlot) return;

            scheduleVisit(bookingId, visitType, visitDate, timeSlot);
        }

        // Schedule visit API call
        async function scheduleVisit(bookingId, visitType, visitDate, timeSlot) {
            try {
                const apiUrl = window.location.hostname === 'localhost' 
                    ? 'http://localhost:5000' 
                    : window.location.origin;

                const response = await fetch(`${apiUrl}/api/booking/requests/${bookingId}/schedule-visit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        visit_type: visitType,
                        visit_date: visitDate,
                        visit_time_slot: timeSlot
                    })
                });

                if (response.ok) {
                    alert('Visit scheduled successfully!');
                    loadBookingRequests();
                } else {
                    alert('Error scheduling visit');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error scheduling visit');
            }
        }
    </script>
</body>
</html>
